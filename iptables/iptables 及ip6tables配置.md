> 主要是`ip6tables`公网ip转发报文控制规则





此部分是华为hn8145V epon光猫提取。其他光猫是否一致暂不清楚。具体自行摸索

主要目的是在IPv6公网模式下，对防火墙规则(ip6tables)的分析，避免整个家庭网络暴露在公网中。


在运营商定制界面(电信)，安全-->防火墙才有“IPv4防火墙”和"IPv6防火墙选项"，华为界面暂时只有防火墙开关，具体配置项可能体现在hw_ctree.xml解密后的配置项中。


# IPv4
## DoS攻击保护
> 关闭后新增以下规则

```
-A PRE_SERVICE -i wan+ -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A PRE_SERVICE -i ppp+ -p icmp -m icmp --icmp-type 8 -j ACCEPT

-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 8 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 8 -j DROP
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 8 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 8 -j DROP
```

## 关闭防火墙后新增以下规则
```
-A PRE_SERVICE -i wan+ -p icmp -m icmp --icmp-type 5 -j ACCEPT
-A PRE_SERVICE -i ppp+ -p icmp -m icmp --icmp-type 5 -j ACCEPT

-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 5 -m limit --limit 1/sec -j ACCEPT
-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 5 -j DROP
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 5 -m limit --limit 1/sec -j ACCEPT
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 5 -j DROP
```




# IPv6
> IPv6防火墙主要是“使能IPv6防火墙控制转发报文”，只有在使能IPv6防火墙控制转发报文功能的情况下，配置的端口映射和IP过滤规则才生效

## 开启和关闭后差异如下：
> (开启则增加以下filter表下FWD_FIREWALL 链规则)

```
-A FWD_FIREWALL -i ppp+ -j DROP
-A FWD_FIREWALL -i wan+ -j DROP
-A FWD_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
```

## PS
> 安全注意！！！
开启转发则无法在外网通过路由下网络设备的IPv6公网IP直接访问，因为路由器在对网络数据包过滤时候会直接丢弃相关数据包

> 关闭转发则将拥有公网IPv6的设备直接完全暴露到公网，需要由子网内设备自身做安全加固


> 针对需要内网部分设备开启IPv6的公网访问的，建议在ip6tables工具内filter表下FWD_FIREWALL 链插入一条放行规则(插入第一条，优先级高于丢弃规则)
以下命令：(将ppp+接口的访问内网80端口的流量转发到内网设备，这样有IPv6公网地址的设备的80端口就暴露在外了)

```
ip6tables -I FORWARD 1 -i ppp+ -p tcp -m tcp --dport 80 -j ACCEPT 
```

> 如果条件允许可以用clouflare做cdn转发，把cf的ip范围加入白名单，这样就可以把防火墙这块转嫁到cf那边配置了。

## 范例
> 比如：(允许wan口或者pppoe拨号口的流量转发到子网设备8080端口)
```
ip6tables -A FORWARD -i ppp+ -o br+ -p tcp --dport 8080 -j ACCEPT
ip6tables -A FORWARD -i wan+ -o br+ -p tcp --dport 8080 -j ACCEPT
```

# 过滤条件说明
```
# 注意ipv6和ipv4的ip地址格式

-i ppp+ 流量来源接口
-o br+ 流量目标接口
-p tcp  指定协议，默认all
--dport  目标端口
-m mac --mac-source 00:11:22:33:44:55 指定来源mac地址
-d 192.168.1.2
-s 192.168.1.100 来源IP地址

-m multiport --dports 21,23,30005,49157 多端口目标端口
-m multiport --sports 21,23,30005,49157 多端口来源端口

-m iprange --src-range 176.16.128.5-176.16.128.10 ip区间 来源ip区间
-m iprange --dst-range 176.16.128.5-176.16.128.10 ip区间 目标ip区间
```

> 具体可以参考 https://www.cnblogs.com/miaocunf/p/11386418.html



> 最后如果让iptables和ip6tables开机配置，可以利用光猫自带的framework下添加开机启动脚本配置，也可以通过恩山大佬的方案，dd 修改固件启动流程中脚本嵌入执行目标脚本




# 附录
> ip6tables(取消报文转发控制)

```
# Generated by ip6tables-save v1.6.1 on Thu Jan  1 00:07:22 1981
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [26:3684]
:POSTROUTING ACCEPT [26:3684]
:PREROUTING_TRAFFIC_FOWARD - [0:0]
:PRE_DNAT_LOWPRI6 - [0:0]
:PRE_SERVICE - [0:0]
-A PREROUTING -j PRE_DNAT_LOWPRI6
-A PREROUTING -j PRE_SERVICE
-A PREROUTING -j PREROUTING_TRAFFIC_FOWARD
COMMIT
# Completed on Thu Jan  1 00:07:22 1981
# Generated by ip6tables-save v1.6.1 on Thu Jan  1 00:07:22 1981
*mangle
:PREROUTING ACCEPT [106:15158]
:INPUT ACCEPT [88:14006]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [290:32924]
:POSTROUTING ACCEPT [318:37810]
:INPUT_HTTP_CAPTURE - [0:0]
:OUTPUT_QOS_ORDER0 - [0:0]
:OUTPUT_QOS_ORDER1 - [0:0]
:POSTROUTING_HTTP_CAPTURE - [0:0]
:POST_MODECONTROL - [0:0]
:PREROUTING_FLOW_TEMPLATE - [0:0]
:PREROUTING_HTTP_CAPTURE - [0:0]
:PRE_MODECONTROL - [0:0]
-A PREROUTING -j PRE_MODECONTROL
-A PREROUTING -i br+ -m mark --mark 0x102001 -j DROP
-A PREROUTING -j PREROUTING_FLOW_TEMPLATE
-A PREROUTING -j PREROUTING_HTTP_CAPTURE
-A PREROUTING -i wan1 -j DROP
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A INPUT -j INPUT_HTTP_CAPTURE
-A OUTPUT -j OUTPUT_QOS_ORDER1
-A OUTPUT -j OUTPUT_QOS_ORDER0
-A POSTROUTING -j POST_MODECONTROL
-A POSTROUTING -j POSTROUTING_HTTP_CAPTURE
-A POSTROUTING -o wan1 -j DROP
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
COMMIT
# Completed on Thu Jan  1 00:07:22 1981
# Generated by ip6tables-save v1.6.1 on Thu Jan  1 00:07:22 1981
*filter
:INPUT ACCEPT [8:1396]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [26:3352]
:FWD_ETH_INVISIBLE - [0:0]
:FWD_FIREWALL - [0:0]
:FWD_FIREWALL_CUST - [0:0]
:FWD_FIREWALL_RULE - [0:0]
:FWD_IPFLT - [0:0]
:FWD_IPFLT_DEFAULT - [0:0]
:FWD_PORTMAP - [0:0]
:FWD_PROTOCOL_FLT - [0:0]
:FWD_REJECT - [0:0]
:FWD_SERVICE - [0:0]
:FWD_SESSION_LIMIT - [0:0]
:FWD_SIP_CHECK - [0:0]
:FWD_WANUPDOWN - [0:0]
:INPUT_ACL - [0:0]
:INPUT_ACL_MAINTENANCE - [0:0]
:INPUT_ACL_PORT - [0:0]
:INPUT_ACL_WAN - [0:0]
:INPUT_ACL_WAN_WHITELIST - [0:0]
:INPUT_ACL_WHITELIST - [0:0]
:INPUT_ACL_WIFI - [0:0]
:INPUT_DOS - [0:0]
:INPUT_FIREWALL - [0:0]
:INPUT_GUEST_NETWORK - [0:0]
:INPUT_PCP_WAN - [0:0]
:INPUT_PROTOCOL_FLT - [0:0]
:INPUT_SERVICE - [0:0]
-A INPUT -j INPUT_PROTOCOL_FLT
-A INPUT -j INPUT_ACL_WAN_WHITELIST
-A INPUT -j INPUT_ACL_WHITELIST
-A INPUT -j INPUT_ACL_PORT
-A INPUT -j INPUT_GUEST_NETWORK
-A INPUT -j INPUT_ACL_WIFI
-A INPUT -j INPUT_ACL_MAINTENANCE
-A INPUT -j INPUT_ACL_WAN
-A INPUT -j INPUT_ACL
-A INPUT -j INPUT_DOS
-A INPUT -j INPUT_SERVICE
-A INPUT -j INPUT_PCP_WAN
-A INPUT -j INPUT_FIREWALL
-A FORWARD -d fc00::/7 -i br+ -o ppp+ -j DROP
-A FORWARD -d fc00::/7 -i br+ -o wan+ -j DROP
-A FORWARD -s fc00::/7 -i br+ -o ppp+ -j DROP
-A FORWARD -s fc00::/7 -i br+ -o wan+ -j DROP
-A FORWARD -j FWD_ETH_INVISIBLE
-A FORWARD -j FWD_SIP_CHECK
-A FORWARD -j FWD_PROTOCOL_FLT
-A FORWARD -j FWD_WANUPDOWN
-A FORWARD -j FWD_REJECT
-A FORWARD -j FWD_IPFLT
-A FORWARD -j FWD_IPFLT_DEFAULT
-A FORWARD -j FWD_SESSION_LIMIT
-A FORWARD -j FWD_SERVICE
-A FORWARD -j FWD_PORTMAP
-A FORWARD -j FWD_FIREWALL_RULE
-A FORWARD -j FWD_FIREWALL_CUST
-A FORWARD -j FWD_FIREWALL
-A OUTPUT -o ra+ -j DROP
-A OUTPUT -o wl+ -j DROP


-A FWD_SERVICE -i br+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SIP_CHECK -i br+ -j DROP
-A FWD_WANUPDOWN -m rt --rt-type 0 -j DROP
-A FWD_WANUPDOWN -o wan+ -m mark --mark 0x102001 -j DROP
-A FWD_WANUPDOWN -o ppp+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -j ACCEPT
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_DOS -i wan+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i wan+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -j DROP
-A INPUT_DOS -i ppp+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i ppp+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -j DROP
-A INPUT_DOS -i wan+ -p ipv6-icmp -m icmp6 --icmpv6-type 137 -j DROP
-A INPUT_DOS -i ppp+ -p ipv6-icmp -m icmp6 --icmpv6-type 137 -j DROP
-A INPUT_FIREWALL -i wan+ -j DROP
-A INPUT_FIREWALL -i ppp+ -j DROP
-A INPUT_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 133 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 134 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 135 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 136 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 141 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 142 -j ACCEPT
COMMIT
# Completed on Thu Jan  1 00:07:22 1981

```

> ip6tables(使能控制报文转发)

```
# Generated by ip6tables-save v1.6.1 on Thu Jan  1 00:12:50 1981
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [34:5216]
:POSTROUTING ACCEPT [34:5216]
:PREROUTING_TRAFFIC_FOWARD - [0:0]
:PRE_DNAT_LOWPRI6 - [0:0]
:PRE_SERVICE - [0:0]
-A PREROUTING -j PRE_DNAT_LOWPRI6
-A PREROUTING -j PRE_SERVICE
-A PREROUTING -j PREROUTING_TRAFFIC_FOWARD
COMMIT
# Completed on Thu Jan  1 00:12:50 1981
# Generated by ip6tables-save v1.6.1 on Thu Jan  1 00:12:50 1981
*mangle
:PREROUTING ACCEPT [116:17128]
:INPUT ACCEPT [98:15976]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [343:39304]
:POSTROUTING ACCEPT [391:47680]
:INPUT_HTTP_CAPTURE - [0:0]
:OUTPUT_QOS_ORDER0 - [0:0]
:OUTPUT_QOS_ORDER1 - [0:0]
:POSTROUTING_HTTP_CAPTURE - [0:0]
:POST_MODECONTROL - [0:0]
:PREROUTING_FLOW_TEMPLATE - [0:0]
:PREROUTING_HTTP_CAPTURE - [0:0]
:PRE_MODECONTROL - [0:0]
-A PREROUTING -j PRE_MODECONTROL
-A PREROUTING -i br+ -m mark --mark 0x102001 -j DROP
-A PREROUTING -j PREROUTING_FLOW_TEMPLATE
-A PREROUTING -j PREROUTING_HTTP_CAPTURE
-A PREROUTING -i wan1 -j DROP
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A INPUT -j INPUT_HTTP_CAPTURE
-A OUTPUT -j OUTPUT_QOS_ORDER1
-A OUTPUT -j OUTPUT_QOS_ORDER0
-A POSTROUTING -j POST_MODECONTROL
-A POSTROUTING -j POSTROUTING_HTTP_CAPTURE
-A POSTROUTING -o wan1 -j DROP
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1392:65535 -j TCPMSS --set-mss 1392
COMMIT
# Completed on Thu Jan  1 00:12:50 1981
# Generated by ip6tables-save v1.6.1 on Thu Jan  1 00:12:50 1981
*filter
:INPUT ACCEPT [98:15976]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [335:38456]
:FWD_ETH_INVISIBLE - [0:0]
:FWD_FIREWALL - [0:0]
:FWD_FIREWALL_CUST - [0:0]
:FWD_FIREWALL_RULE - [0:0]
:FWD_IPFLT - [0:0]
:FWD_IPFLT_DEFAULT - [0:0]
:FWD_PORTMAP - [0:0]
:FWD_PROTOCOL_FLT - [0:0]
:FWD_REJECT - [0:0]
:FWD_SERVICE - [0:0]
:FWD_SESSION_LIMIT - [0:0]
:FWD_SIP_CHECK - [0:0]
:FWD_WANUPDOWN - [0:0]
:INPUT_ACL - [0:0]
:INPUT_ACL_MAINTENANCE - [0:0]
:INPUT_ACL_PORT - [0:0]
:INPUT_ACL_WAN - [0:0]
:INPUT_ACL_WAN_WHITELIST - [0:0]
:INPUT_ACL_WHITELIST - [0:0]
:INPUT_ACL_WIFI - [0:0]
:INPUT_DOS - [0:0]
:INPUT_FIREWALL - [0:0]
:INPUT_GUEST_NETWORK - [0:0]
:INPUT_PCP_WAN - [0:0]
:INPUT_PROTOCOL_FLT - [0:0]
:INPUT_SERVICE - [0:0]
-A INPUT -j INPUT_PROTOCOL_FLT
-A INPUT -j INPUT_ACL_WAN_WHITELIST
-A INPUT -j INPUT_ACL_WHITELIST
-A INPUT -j INPUT_ACL_PORT
-A INPUT -j INPUT_GUEST_NETWORK
-A INPUT -j INPUT_ACL_WIFI
-A INPUT -j INPUT_ACL_MAINTENANCE
-A INPUT -j INPUT_ACL_WAN
-A INPUT -j INPUT_ACL
-A INPUT -j INPUT_DOS
-A INPUT -j INPUT_SERVICE
-A INPUT -j INPUT_PCP_WAN
-A INPUT -j INPUT_FIREWALL
-A FORWARD -d fc00::/7 -i br+ -o ppp+ -j DROP
-A FORWARD -d fc00::/7 -i br+ -o wan+ -j DROP
-A FORWARD -s fc00::/7 -i br+ -o ppp+ -j DROP
-A FORWARD -s fc00::/7 -i br+ -o wan+ -j DROP
-A FORWARD -j FWD_ETH_INVISIBLE
-A FORWARD -j FWD_SIP_CHECK
-A FORWARD -j FWD_PROTOCOL_FLT
-A FORWARD -j FWD_WANUPDOWN
-A FORWARD -j FWD_REJECT
-A FORWARD -j FWD_IPFLT
-A FORWARD -j FWD_IPFLT_DEFAULT
-A FORWARD -j FWD_SESSION_LIMIT
-A FORWARD -j FWD_SERVICE
-A FORWARD -j FWD_PORTMAP
-A FORWARD -j FWD_FIREWALL_RULE
-A FORWARD -j FWD_FIREWALL_CUST
-A FORWARD -j FWD_FIREWALL
-A OUTPUT -o ra+ -j DROP
-A OUTPUT -o wl+ -j DROP
-A FWD_FIREWALL -i ppp+ -j DROP
-A FWD_FIREWALL -i wan+ -j DROP
-A FWD_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -i br+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SIP_CHECK -i br+ -j DROP
-A FWD_WANUPDOWN -m rt --rt-type 0 -j DROP
-A FWD_WANUPDOWN -o wan+ -m mark --mark 0x102001 -j DROP
-A FWD_WANUPDOWN -o ppp+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -j ACCEPT
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_DOS -i wan+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i wan+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -j DROP
-A INPUT_DOS -i ppp+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i ppp+ -p ipv6-icmp -m icmp6 --icmpv6-type 128 -j DROP
-A INPUT_DOS -i wan+ -p ipv6-icmp -m icmp6 --icmpv6-type 137 -j DROP
-A INPUT_DOS -i ppp+ -p ipv6-icmp -m icmp6 --icmpv6-type 137 -j DROP
-A INPUT_FIREWALL -i wan+ -j DROP
-A INPUT_FIREWALL -i ppp+ -j DROP
-A INPUT_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 133 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 134 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 135 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 136 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 141 -j ACCEPT
-A INPUT_SERVICE -p ipv6-icmp -m icmp6 --icmpv6-type 142 -j ACCEPT
COMMIT
# Completed on Thu Jan  1 00:12:50 1981

```


> iptables关闭Dos防护

```
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:27:06 1981
*nat
:PREROUTING ACCEPT [100:8606]
:INPUT ACCEPT [2:798]
:OUTPUT ACCEPT [4:433]
:POSTROUTING ACCEPT [4:433]
:POST_AWIFI_IPMAPING - [0:0]
:POST_AWIFI_L2TP - [0:0]
:POST_DMZIF - [0:0]
:POST_IPMAPING - [0:0]
:POST_IPMAPPING_NATLB - [0:0]
:POST_L2TP - [0:0]
:POST_PORTMAP_NATLB - [0:0]
:POST_UPNP_PORTMAP_NATLB - [0:0]
:POST_UPNP_PORTMAP_WANNAT - [0:0]
:POST_WANNAT - [0:0]
:PREROUTING_TRAFFIC_FOWARD - [0:0]
:PRE_ACL_OTHER - [0:0]
:PRE_DMZ - [0:0]
:PRE_DMZ_PRIORITY - [0:0]
:PRE_DNAT - [0:0]
:PRE_DNAT_LOWPRI - [0:0]
:PRE_FIREWALL - [0:0]
:PRE_HTTP_PORTMAP - [0:0]
:PRE_INPUT_ACL_MAINTENANCE - [0:0]
:PRE_IPMAPING - [0:0]
:PRE_IPMAPPING_NATLB - [0:0]
:PRE_IWF_PORTMAP - [0:0]
:PRE_LEVEL_RULE - [0:0]
:PRE_PCP_PORTMAP - [0:0]
:PRE_PORTMAP - [0:0]
:PRE_PORTMAP_NATLB - [0:0]
:PRE_PORTTRIGGER - [0:0]
:PRE_REDIRECT - [0:0]
:PRE_REMOTE_WAN_ACL - [0:0]
:PRE_SERVICE - [0:0]
:PRE_UPNP_PORTMAP - [0:0]
:PRE_UPNP_PORTMAP_NATLB - [0:0]
-A PREROUTING -j PRE_REDIRECT
-A PREROUTING -j PRE_IPMAPING
-A PREROUTING -j PRE_DNAT
-A PREROUTING -j PRE_DNAT_LOWPRI
-A PREROUTING -j PRE_IWF_PORTMAP
-A PREROUTING -j PRE_PCP_PORTMAP
-A PREROUTING -j PRE_SERVICE
-A PREROUTING -j PRE_HTTP_PORTMAP
-A PREROUTING -j PRE_UPNP_PORTMAP
-A PREROUTING -j PRE_PORTMAP
-A PREROUTING -j PRE_LEVEL_RULE
-A PREROUTING -j PRE_PORTTRIGGER
-A PREROUTING -j PRE_DMZ_PRIORITY
-A PREROUTING -j PRE_INPUT_ACL_MAINTENANCE
-A PREROUTING -j PRE_ACL_OTHER
-A PREROUTING -j PRE_REMOTE_WAN_ACL
-A PREROUTING -j PRE_DMZ
-A PREROUTING -j PRE_FIREWALL
-A PREROUTING -j PRE_UPNP_PORTMAP_NATLB
-A PREROUTING -j PRE_PORTMAP_NATLB
-A PREROUTING -j PRE_IPMAPPING_NATLB
-A PREROUTING -j PREROUTING_TRAFFIC_FOWARD
-A POSTROUTING -s 10.0.3.0/24 ! -d 10.0.3.0/24 -j MASQUERADE
-A POSTROUTING -j POST_AWIFI_L2TP
-A POSTROUTING -j POST_L2TP
-A POSTROUTING -j POST_DMZIF
-A POSTROUTING -j POST_AWIFI_IPMAPING
-A POSTROUTING -j POST_IPMAPING
-A POSTROUTING -j POST_UPNP_PORTMAP_WANNAT
-A POSTROUTING -j POST_WANNAT
-A POSTROUTING -j POST_UPNP_PORTMAP_NATLB
-A POSTROUTING -j POST_PORTMAP_NATLB
-A POSTROUTING -j POST_IPMAPPING_NATLB
-A POST_WANNAT -o ppp259 -j CONENAT
-A PREROUTING_TRAFFIC_FOWARD -d 192.168.1.1/32 -j RETURN
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x10000 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x10000 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x4 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x4 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x3 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x3 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x2 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x2 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x1 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x1 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -i br+ -p udp -m udp --dport 1900 -j DNAT --to-destination 239.255.255.250:1900
-A PRE_SERVICE -i wan+ -p udp -m udp --dport 67:68 -m limit --limit 400/sec -j ACCEPT
-A PRE_SERVICE -i wan+ -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A PRE_SERVICE -i ppp+ -p icmp -m icmp --icmp-type 8 -j ACCEPT
COMMIT
# Completed on Thu Jan  1 00:27:06 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:27:06 1981
*raw
:PREROUTING ACCEPT [20880:1946930]
:OUTPUT ACCEPT [10244:9004163]
COMMIT
# Completed on Thu Jan  1 00:27:06 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:27:06 1981
*mangle
:PREROUTING ACCEPT [20881:1946970]
:INPUT ACCEPT [5736:687298]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [10245:9004563]
:POSTROUTING ACCEPT [10345:9020613]
:FWD_SESSION_LIMIT - [0:0]
:INPUT_HTTP_CAPTURE - [0:0]
:OUTPUT_QOS_ORDER0 - [0:0]
:OUTPUT_QOS_ORDER1 - [0:0]
:POSTROUTING_HTTP_CAPTURE - [0:0]
:PREROUTING_FLOW_TEMPLATE - [0:0]
:PREROUTING_HTTP_CAPTURE - [0:0]
-A PREROUTING -j PREROUTING_FLOW_TEMPLATE
-A PREROUTING -j PREROUTING_HTTP_CAPTURE
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A INPUT -j INPUT_HTTP_CAPTURE
-A FORWARD -j FWD_SESSION_LIMIT
-A OUTPUT -j OUTPUT_QOS_ORDER1
-A OUTPUT -j OUTPUT_QOS_ORDER0
-A POSTROUTING -j POSTROUTING_HTTP_CAPTURE
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
COMMIT
# Completed on Thu Jan  1 00:27:06 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:27:06 1981
*filter
:INPUT ACCEPT [6:462]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [284:287818]
:FWD_ALG - [0:0]
:FWD_DMZ - [0:0]
:FWD_DMZIF - [0:0]
:FWD_DSLITE_IPFLT - [0:0]
:FWD_ETH_INVISIBLE - [0:0]
:FWD_FIREWALL - [0:0]
:FWD_FIREWALL_COMMON - [0:0]
:FWD_FIREWALL_CUST - [0:0]
:FWD_FIREWALL_RULE - [0:0]
:FWD_GUEST_NETWORK - [0:0]
:FWD_HTTP_PORTMAP - [0:0]
:FWD_IPFLT - [0:0]
:FWD_IPFLT_DEFAULT - [0:0]
:FWD_IPMAPPING - [0:0]
:FWD_IWF_PORTMAP - [0:0]
:FWD_PCP_PORTMAP - [0:0]
:FWD_PORTMAP - [0:0]
:FWD_PORTTRIGGER - [0:0]
:FWD_PORT_SCAN - [0:0]
:FWD_REJECT - [0:0]
:FWD_SERVICE - [0:0]
:FWD_SESSION_LIMIT - [0:0]
:FWD_TRAFFIC_FOWARD - [0:0]
:FWD_TUNNEL_FILTER_DEFAULT - [0:0]
:FWD_UPNP_PORTMAP - [0:0]
:FWD_WANSIM - [0:0]
:FWD_WANUPDOWN - [0:0]
:INPUT_ACL - [0:0]
:INPUT_ACL_MAINTENANCE - [0:0]
:INPUT_ACL_OTHER - [0:0]
:INPUT_ACL_PORT - [0:0]
:INPUT_ACL_WAN - [0:0]
:INPUT_ACL_WAN_WHITELIST - [0:0]
:INPUT_ACL_WHITELIST - [0:0]
:INPUT_ACL_WIFI - [0:0]
:INPUT_DMZIF - [0:0]
:INPUT_DOS - [0:0]
:INPUT_FIREWALL - [0:0]
:INPUT_FIREWALL_ACL - [0:0]
:INPUT_GUEST_NETWORK - [0:0]
:INPUT_PCP_WAN - [0:0]
:INPUT_PORT_SCAN - [0:0]
:INPUT_SERVICE - [0:0]
:INPUT_VOICE - [0:0]
:OUTPUT_WANSIM - [0:0]
-A INPUT -d 224.0.0.99/32 -i br+ -p udp -m udp --dport 4891 -j ACCEPT
-A INPUT -d 255.255.255.255/32 -i br+ -p udp -m udp --dport 6878 -j ACCEPT
-A INPUT -d 255.255.255.255/32 -i br+ -p udp -m udp --dport 6877 -j ACCEPT
-A INPUT -j INPUT_PORT_SCAN
-A INPUT -j INPUT_DMZIF
-A INPUT -j INPUT_VOICE
-A INPUT -j INPUT_ACL_MAINTENANCE
-A INPUT -j INPUT_ACL_WAN_WHITELIST
-A INPUT -j INPUT_ACL_WHITELIST
-A INPUT -j INPUT_ACL_PORT
-A INPUT -j INPUT_GUEST_NETWORK
-A INPUT -j INPUT_ACL_WIFI
-A INPUT -j INPUT_ACL_WAN
-A INPUT -j INPUT_ACL
-A INPUT -j INPUT_FIREWALL_ACL
-A INPUT -j INPUT_DOS
-A INPUT -j INPUT_ACL_OTHER
-A INPUT -j INPUT_SERVICE
-A INPUT -j INPUT_PCP_WAN
-A INPUT -j INPUT_FIREWALL
-A FORWARD -j FWD_PORT_SCAN
-A FORWARD -j FWD_REJECT
-A FORWARD -j FWD_GUEST_NETWORK
-A FORWARD -j FWD_ETH_INVISIBLE
-A FORWARD -j FWD_DMZIF
-A FORWARD -j FWD_WANSIM
-A FORWARD -j FWD_WANUPDOWN
-A FORWARD -j FWD_ALG
-A FORWARD -j FWD_IPFLT
-A FORWARD -j FWD_DSLITE_IPFLT
-A FORWARD -j FWD_IPFLT_DEFAULT
-A FORWARD -j FWD_FIREWALL_COMMON
-A FORWARD -j FWD_TRAFFIC_FOWARD
-A FORWARD -j FWD_SESSION_LIMIT
-A FORWARD -j FWD_IWF_PORTMAP
-A FORWARD -j FWD_PCP_PORTMAP
-A FORWARD -j FWD_UPNP_PORTMAP
-A FORWARD -j FWD_SERVICE
-A FORWARD -j FWD_HTTP_PORTMAP
-A FORWARD -j FWD_PORTMAP
-A FORWARD -j FWD_FIREWALL_RULE
-A FORWARD -j FWD_PORTTRIGGER
-A FORWARD -j FWD_IPMAPPING
-A FORWARD -j FWD_DMZ
-A FORWARD -j FWD_TUNNEL_FILTER_DEFAULT
-A FORWARD -j FWD_FIREWALL_CUST
-A FORWARD -j FWD_FIREWALL
-A OUTPUT -j OUTPUT_WANSIM
-A FWD_FIREWALL -i wan+ -j DROP
-A FWD_FIREWALL -i ppp+ -j DROP
-A FWD_FIREWALL -i br+ -m mark --mark 0x102001 -j DROP
-A FWD_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_TRAFFIC_FOWARD -d 192.168.1.1/32 -j RETURN
-A FWD_WANUPDOWN -o wan+ -m mark --mark 0x102001 -j DROP
-A FWD_WANUPDOWN -o ppp+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p icmp -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 21 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 21 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 21 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_DMZIF -p icmp -m icmp --icmp-type 13 -j DROP
-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 8 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 8 -j DROP
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 8 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 8 -j DROP
-A INPUT_FIREWALL -i wan+ -j DROP
-A INPUT_FIREWALL -i ppp+ -j DROP
-A INPUT_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i wan+ -p tcp -m tcp --dport 53 -j DROP
-A INPUT_SERVICE -i wan+ -p udp -m udp --dport 53 -j DROP
-A INPUT_SERVICE -i ppp+ -p tcp -m tcp --dport 53 -j DROP
-A INPUT_SERVICE -i ppp+ -p udp -m udp --dport 53 -j DROP
-A INPUT_SERVICE -i wan1 -p udp -m udp --dport 68 -j ACCEPT
-A INPUT_SERVICE -i br0 -p udp -m udp --dport 1900 -j ACCEPT
-A INPUT_SERVICE -i br0 -p tcp -m tcp --dport 37443 -j ACCEPT
COMMIT
# Completed on Thu Jan  1 00:27:06 1981

```

> iptables开启Dos防护

```
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:26:16 1981
*nat
:PREROUTING ACCEPT [337:26538]
:INPUT ACCEPT [4:972]
:OUTPUT ACCEPT [12:1497]
:POSTROUTING ACCEPT [12:1497]
:POST_AWIFI_IPMAPING - [0:0]
:POST_AWIFI_L2TP - [0:0]
:POST_DMZIF - [0:0]
:POST_IPMAPING - [0:0]
:POST_IPMAPPING_NATLB - [0:0]
:POST_L2TP - [0:0]
:POST_PORTMAP_NATLB - [0:0]
:POST_UPNP_PORTMAP_NATLB - [0:0]
:POST_UPNP_PORTMAP_WANNAT - [0:0]
:POST_WANNAT - [0:0]
:PREROUTING_TRAFFIC_FOWARD - [0:0]
:PRE_ACL_OTHER - [0:0]
:PRE_DMZ - [0:0]
:PRE_DMZ_PRIORITY - [0:0]
:PRE_DNAT - [0:0]
:PRE_DNAT_LOWPRI - [0:0]
:PRE_FIREWALL - [0:0]
:PRE_HTTP_PORTMAP - [0:0]
:PRE_INPUT_ACL_MAINTENANCE - [0:0]
:PRE_IPMAPING - [0:0]
:PRE_IPMAPPING_NATLB - [0:0]
:PRE_IWF_PORTMAP - [0:0]
:PRE_LEVEL_RULE - [0:0]
:PRE_PCP_PORTMAP - [0:0]
:PRE_PORTMAP - [0:0]
:PRE_PORTMAP_NATLB - [0:0]
:PRE_PORTTRIGGER - [0:0]
:PRE_REDIRECT - [0:0]
:PRE_REMOTE_WAN_ACL - [0:0]
:PRE_SERVICE - [0:0]
:PRE_UPNP_PORTMAP - [0:0]
:PRE_UPNP_PORTMAP_NATLB - [0:0]
-A PREROUTING -j PRE_REDIRECT
-A PREROUTING -j PRE_IPMAPING
-A PREROUTING -j PRE_DNAT
-A PREROUTING -j PRE_DNAT_LOWPRI
-A PREROUTING -j PRE_IWF_PORTMAP
-A PREROUTING -j PRE_PCP_PORTMAP
-A PREROUTING -j PRE_SERVICE
-A PREROUTING -j PRE_HTTP_PORTMAP
-A PREROUTING -j PRE_UPNP_PORTMAP
-A PREROUTING -j PRE_PORTMAP
-A PREROUTING -j PRE_LEVEL_RULE
-A PREROUTING -j PRE_PORTTRIGGER
-A PREROUTING -j PRE_DMZ_PRIORITY
-A PREROUTING -j PRE_INPUT_ACL_MAINTENANCE
-A PREROUTING -j PRE_ACL_OTHER
-A PREROUTING -j PRE_REMOTE_WAN_ACL
-A PREROUTING -j PRE_DMZ
-A PREROUTING -j PRE_FIREWALL
-A PREROUTING -j PRE_UPNP_PORTMAP_NATLB
-A PREROUTING -j PRE_PORTMAP_NATLB
-A PREROUTING -j PRE_IPMAPPING_NATLB
-A PREROUTING -j PREROUTING_TRAFFIC_FOWARD
-A POSTROUTING -s 10.0.3.0/24 ! -d 10.0.3.0/24 -j MASQUERADE
-A POSTROUTING -j POST_AWIFI_L2TP
-A POSTROUTING -j POST_L2TP
-A POSTROUTING -j POST_DMZIF
-A POSTROUTING -j POST_AWIFI_IPMAPING
-A POSTROUTING -j POST_IPMAPING
-A POSTROUTING -j POST_UPNP_PORTMAP_WANNAT
-A POSTROUTING -j POST_WANNAT
-A POSTROUTING -j POST_UPNP_PORTMAP_NATLB
-A POSTROUTING -j POST_PORTMAP_NATLB
-A POSTROUTING -j POST_IPMAPPING_NATLB
-A POST_WANNAT -o ppp259 -j CONENAT
-A PREROUTING_TRAFFIC_FOWARD -d 192.168.1.1/32 -j RETURN
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x10000 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x10000 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x4 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x4 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x3 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x3 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x2 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x2 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x1 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x1 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -i br+ -p udp -m udp --dport 1900 -j DNAT --to-destination 239.255.255.250:1900
-A PRE_SERVICE -i wan+ -p udp -m udp --dport 67:68 -m limit --limit 400/sec -j ACCEPT


COMMIT
# Completed on Thu Jan  1 00:26:16 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:26:16 1981
*raw
:PREROUTING ACCEPT [20111:1878803]
:OUTPUT ACCEPT [9893:8702499]
COMMIT
# Completed on Thu Jan  1 00:26:16 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:26:16 1981
*mangle
:PREROUTING ACCEPT [20111:1878803]
:INPUT ACCEPT [5516:660087]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [9894:8703999]
:POSTROUTING ACCEPT [9994:8720049]
:FWD_SESSION_LIMIT - [0:0]
:INPUT_HTTP_CAPTURE - [0:0]
:OUTPUT_QOS_ORDER0 - [0:0]
:OUTPUT_QOS_ORDER1 - [0:0]
:POSTROUTING_HTTP_CAPTURE - [0:0]
:PREROUTING_FLOW_TEMPLATE - [0:0]
:PREROUTING_HTTP_CAPTURE - [0:0]
-A PREROUTING -j PREROUTING_FLOW_TEMPLATE
-A PREROUTING -j PREROUTING_HTTP_CAPTURE
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A INPUT -j INPUT_HTTP_CAPTURE
-A FORWARD -j FWD_SESSION_LIMIT
-A OUTPUT -j OUTPUT_QOS_ORDER1
-A OUTPUT -j OUTPUT_QOS_ORDER0
-A POSTROUTING -j POSTROUTING_HTTP_CAPTURE
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
COMMIT
# Completed on Thu Jan  1 00:26:16 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:26:16 1981
*filter
:INPUT ACCEPT [21:2514]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [324:291472]
:FWD_ALG - [0:0]
:FWD_DMZ - [0:0]
:FWD_DMZIF - [0:0]
:FWD_DSLITE_IPFLT - [0:0]
:FWD_ETH_INVISIBLE - [0:0]
:FWD_FIREWALL - [0:0]
:FWD_FIREWALL_COMMON - [0:0]
:FWD_FIREWALL_CUST - [0:0]
:FWD_FIREWALL_RULE - [0:0]
:FWD_GUEST_NETWORK - [0:0]
:FWD_HTTP_PORTMAP - [0:0]
:FWD_IPFLT - [0:0]
:FWD_IPFLT_DEFAULT - [0:0]
:FWD_IPMAPPING - [0:0]
:FWD_IWF_PORTMAP - [0:0]
:FWD_PCP_PORTMAP - [0:0]
:FWD_PORTMAP - [0:0]
:FWD_PORTTRIGGER - [0:0]
:FWD_PORT_SCAN - [0:0]
:FWD_REJECT - [0:0]
:FWD_SERVICE - [0:0]
:FWD_SESSION_LIMIT - [0:0]
:FWD_TRAFFIC_FOWARD - [0:0]
:FWD_TUNNEL_FILTER_DEFAULT - [0:0]
:FWD_UPNP_PORTMAP - [0:0]
:FWD_WANSIM - [0:0]
:FWD_WANUPDOWN - [0:0]
:INPUT_ACL - [0:0]
:INPUT_ACL_MAINTENANCE - [0:0]
:INPUT_ACL_OTHER - [0:0]
:INPUT_ACL_PORT - [0:0]
:INPUT_ACL_WAN - [0:0]
:INPUT_ACL_WAN_WHITELIST - [0:0]
:INPUT_ACL_WHITELIST - [0:0]
:INPUT_ACL_WIFI - [0:0]
:INPUT_DMZIF - [0:0]
:INPUT_DOS - [0:0]
:INPUT_FIREWALL - [0:0]
:INPUT_FIREWALL_ACL - [0:0]
:INPUT_GUEST_NETWORK - [0:0]
:INPUT_PCP_WAN - [0:0]
:INPUT_PORT_SCAN - [0:0]
:INPUT_SERVICE - [0:0]
:INPUT_VOICE - [0:0]
:OUTPUT_WANSIM - [0:0]
-A INPUT -d 224.0.0.99/32 -i br+ -p udp -m udp --dport 4891 -j ACCEPT
-A INPUT -d 255.255.255.255/32 -i br+ -p udp -m udp --dport 6878 -j ACCEPT
-A INPUT -d 255.255.255.255/32 -i br+ -p udp -m udp --dport 6877 -j ACCEPT
-A INPUT -j INPUT_PORT_SCAN
-A INPUT -j INPUT_DMZIF
-A INPUT -j INPUT_VOICE
-A INPUT -j INPUT_ACL_MAINTENANCE
-A INPUT -j INPUT_ACL_WAN_WHITELIST
-A INPUT -j INPUT_ACL_WHITELIST
-A INPUT -j INPUT_ACL_PORT
-A INPUT -j INPUT_GUEST_NETWORK
-A INPUT -j INPUT_ACL_WIFI
-A INPUT -j INPUT_ACL_WAN
-A INPUT -j INPUT_ACL
-A INPUT -j INPUT_FIREWALL_ACL
-A INPUT -j INPUT_DOS
-A INPUT -j INPUT_ACL_OTHER
-A INPUT -j INPUT_SERVICE
-A INPUT -j INPUT_PCP_WAN
-A INPUT -j INPUT_FIREWALL
-A FORWARD -j FWD_PORT_SCAN
-A FORWARD -j FWD_REJECT
-A FORWARD -j FWD_GUEST_NETWORK
-A FORWARD -j FWD_ETH_INVISIBLE
-A FORWARD -j FWD_DMZIF
-A FORWARD -j FWD_WANSIM
-A FORWARD -j FWD_WANUPDOWN
-A FORWARD -j FWD_ALG
-A FORWARD -j FWD_IPFLT
-A FORWARD -j FWD_DSLITE_IPFLT
-A FORWARD -j FWD_IPFLT_DEFAULT
-A FORWARD -j FWD_FIREWALL_COMMON
-A FORWARD -j FWD_TRAFFIC_FOWARD
-A FORWARD -j FWD_SESSION_LIMIT
-A FORWARD -j FWD_IWF_PORTMAP
-A FORWARD -j FWD_PCP_PORTMAP
-A FORWARD -j FWD_UPNP_PORTMAP
-A FORWARD -j FWD_SERVICE
-A FORWARD -j FWD_HTTP_PORTMAP
-A FORWARD -j FWD_PORTMAP
-A FORWARD -j FWD_FIREWALL_RULE
-A FORWARD -j FWD_PORTTRIGGER
-A FORWARD -j FWD_IPMAPPING
-A FORWARD -j FWD_DMZ
-A FORWARD -j FWD_TUNNEL_FILTER_DEFAULT
-A FORWARD -j FWD_FIREWALL_CUST
-A FORWARD -j FWD_FIREWALL
-A OUTPUT -j OUTPUT_WANSIM
-A FWD_FIREWALL -i wan+ -j DROP
-A FWD_FIREWALL -i ppp+ -j DROP
-A FWD_FIREWALL -i br+ -m mark --mark 0x102001 -j DROP
-A FWD_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_TRAFFIC_FOWARD -d 192.168.1.1/32 -j RETURN
-A FWD_WANUPDOWN -o wan+ -m mark --mark 0x102001 -j DROP
-A FWD_WANUPDOWN -o ppp+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p icmp -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 21 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 21 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 21 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_DMZIF -p icmp -m icmp --icmp-type 13 -j DROP
-A INPUT_FIREWALL -i wan+ -j DROP
-A INPUT_FIREWALL -i ppp+ -j DROP
-A INPUT_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i wan+ -p tcp -m tcp --dport 53 -j DROP
-A INPUT_SERVICE -i wan+ -p udp -m udp --dport 53 -j DROP
-A INPUT_SERVICE -i ppp+ -p tcp -m tcp --dport 53 -j DROP
-A INPUT_SERVICE -i ppp+ -p udp -m udp --dport 53 -j DROP
-A INPUT_SERVICE -i wan1 -p udp -m udp --dport 68 -j ACCEPT
-A INPUT_SERVICE -i br0 -p udp -m udp --dport 1900 -j ACCEPT
-A INPUT_SERVICE -i br0 -p tcp -m tcp --dport 37443 -j ACCEPT
COMMIT
# Completed on Thu Jan  1 00:26:16 1981

```

> iptables(关闭防火墙)

```
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:33:37 1981
*nat
:PREROUTING ACCEPT [121:11921]
:INPUT ACCEPT [3:1603]
:OUTPUT ACCEPT [6:1119]
:POSTROUTING ACCEPT [6:1119]
:POST_AWIFI_IPMAPING - [0:0]
:POST_AWIFI_L2TP - [0:0]
:POST_DMZIF - [0:0]
:POST_IPMAPING - [0:0]
:POST_IPMAPPING_NATLB - [0:0]
:POST_L2TP - [0:0]
:POST_PORTMAP_NATLB - [0:0]
:POST_UPNP_PORTMAP_NATLB - [0:0]
:POST_UPNP_PORTMAP_WANNAT - [0:0]
:POST_WANNAT - [0:0]
:PREROUTING_TRAFFIC_FOWARD - [0:0]
:PRE_ACL_OTHER - [0:0]
:PRE_DMZ - [0:0]
:PRE_DMZ_PRIORITY - [0:0]
:PRE_DNAT - [0:0]
:PRE_DNAT_LOWPRI - [0:0]
:PRE_FIREWALL - [0:0]
:PRE_HTTP_PORTMAP - [0:0]
:PRE_INPUT_ACL_MAINTENANCE - [0:0]
:PRE_IPMAPING - [0:0]
:PRE_IPMAPPING_NATLB - [0:0]
:PRE_IWF_PORTMAP - [0:0]
:PRE_LEVEL_RULE - [0:0]
:PRE_PCP_PORTMAP - [0:0]
:PRE_PORTMAP - [0:0]
:PRE_PORTMAP_NATLB - [0:0]
:PRE_PORTTRIGGER - [0:0]
:PRE_REDIRECT - [0:0]
:PRE_REMOTE_WAN_ACL - [0:0]
:PRE_SERVICE - [0:0]
:PRE_UPNP_PORTMAP - [0:0]
:PRE_UPNP_PORTMAP_NATLB - [0:0]
-A PREROUTING -j PRE_REDIRECT
-A PREROUTING -j PRE_IPMAPING
-A PREROUTING -j PRE_DNAT
-A PREROUTING -j PRE_DNAT_LOWPRI
-A PREROUTING -j PRE_IWF_PORTMAP
-A PREROUTING -j PRE_PCP_PORTMAP
-A PREROUTING -j PRE_SERVICE
-A PREROUTING -j PRE_HTTP_PORTMAP
-A PREROUTING -j PRE_UPNP_PORTMAP
-A PREROUTING -j PRE_PORTMAP
-A PREROUTING -j PRE_LEVEL_RULE
-A PREROUTING -j PRE_PORTTRIGGER
-A PREROUTING -j PRE_DMZ_PRIORITY
-A PREROUTING -j PRE_INPUT_ACL_MAINTENANCE
-A PREROUTING -j PRE_ACL_OTHER
-A PREROUTING -j PRE_REMOTE_WAN_ACL
-A PREROUTING -j PRE_DMZ
-A PREROUTING -j PRE_FIREWALL
-A PREROUTING -j PRE_UPNP_PORTMAP_NATLB
-A PREROUTING -j PRE_PORTMAP_NATLB
-A PREROUTING -j PRE_IPMAPPING_NATLB
-A PREROUTING -j PREROUTING_TRAFFIC_FOWARD
-A POSTROUTING -s 10.0.3.0/24 ! -d 10.0.3.0/24 -j MASQUERADE
-A POSTROUTING -j POST_AWIFI_L2TP
-A POSTROUTING -j POST_L2TP
-A POSTROUTING -j POST_DMZIF
-A POSTROUTING -j POST_AWIFI_IPMAPING
-A POSTROUTING -j POST_IPMAPING
-A POSTROUTING -j POST_UPNP_PORTMAP_WANNAT
-A POSTROUTING -j POST_WANNAT
-A POSTROUTING -j POST_UPNP_PORTMAP_NATLB
-A POSTROUTING -j POST_PORTMAP_NATLB
-A POSTROUTING -j POST_IPMAPPING_NATLB
-A POST_WANNAT -o ppp259 -j CONENAT
-A PREROUTING_TRAFFIC_FOWARD -d 192.168.1.1/32 -j RETURN
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x10000 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x10000 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x4 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x4 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x3 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x3 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x2 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x2 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p udp -m udp --dport 53 -m mark --mark 0x1 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -p tcp -m tcp --dport 53 -m mark --mark 0x1 -j DNAT --to-destination 169.254.105.188:53
-A PRE_DNAT -d 192.168.1.1/32 -i br+ -p udp -m udp --dport 1900 -j DNAT --to-destination 239.255.255.250:1900
-A PRE_SERVICE -i wan+ -p udp -m udp --dport 67:68 -m limit --limit 400/sec -j ACCEPT
-A PRE_SERVICE -i wan+ -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A PRE_SERVICE -i ppp+ -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A PRE_SERVICE -i wan+ -p icmp -m icmp --icmp-type 5 -j ACCEPT
-A PRE_SERVICE -i ppp+ -p icmp -m icmp --icmp-type 5 -j ACCEPT
COMMIT
# Completed on Thu Jan  1 00:33:37 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:33:37 1981
*raw
:PREROUTING ACCEPT [25744:2422510]
:OUTPUT ACCEPT [12412:10775044]
COMMIT
# Completed on Thu Jan  1 00:33:37 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:33:37 1981
*mangle
:PREROUTING ACCEPT [25745:2422550]
:INPUT ACCEPT [7040:868206]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [12413:10775390]
:POSTROUTING ACCEPT [12541:10795934]
:FWD_SESSION_LIMIT - [0:0]
:INPUT_HTTP_CAPTURE - [0:0]
:OUTPUT_QOS_ORDER0 - [0:0]
:OUTPUT_QOS_ORDER1 - [0:0]
:POSTROUTING_HTTP_CAPTURE - [0:0]
:PREROUTING_FLOW_TEMPLATE - [0:0]
:PREROUTING_HTTP_CAPTURE - [0:0]
-A PREROUTING -j PREROUTING_FLOW_TEMPLATE
-A PREROUTING -j PREROUTING_HTTP_CAPTURE
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A PREROUTING -i ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A INPUT -j INPUT_HTTP_CAPTURE
-A FORWARD -j FWD_SESSION_LIMIT
-A OUTPUT -j OUTPUT_QOS_ORDER1
-A OUTPUT -j OUTPUT_QOS_ORDER0
-A POSTROUTING -j POSTROUTING_HTTP_CAPTURE
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o wan1 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
-A POSTROUTING -o ppp259 -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN,ACK -m tcpmss --mss 1412:65535 -j TCPMSS --set-mss 1412
COMMIT
# Completed on Thu Jan  1 00:33:37 1981
# Generated by iptables-save v1.6.1 on Thu Jan  1 00:33:37 1981
*filter
:INPUT ACCEPT [8:1514]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [318:291535]
:FWD_ALG - [0:0]
:FWD_DMZ - [0:0]
:FWD_DMZIF - [0:0]
:FWD_DSLITE_IPFLT - [0:0]
:FWD_ETH_INVISIBLE - [0:0]
:FWD_FIREWALL - [0:0]
:FWD_FIREWALL_COMMON - [0:0]
:FWD_FIREWALL_CUST - [0:0]
:FWD_FIREWALL_RULE - [0:0]
:FWD_GUEST_NETWORK - [0:0]
:FWD_HTTP_PORTMAP - [0:0]
:FWD_IPFLT - [0:0]
:FWD_IPFLT_DEFAULT - [0:0]
:FWD_IPMAPPING - [0:0]
:FWD_IWF_PORTMAP - [0:0]
:FWD_PCP_PORTMAP - [0:0]
:FWD_PORTMAP - [0:0]
:FWD_PORTTRIGGER - [0:0]
:FWD_PORT_SCAN - [0:0]
:FWD_REJECT - [0:0]
:FWD_SERVICE - [0:0]
:FWD_SESSION_LIMIT - [0:0]
:FWD_TRAFFIC_FOWARD - [0:0]
:FWD_TUNNEL_FILTER_DEFAULT - [0:0]
:FWD_UPNP_PORTMAP - [0:0]
:FWD_WANSIM - [0:0]
:FWD_WANUPDOWN - [0:0]
:INPUT_ACL - [0:0]
:INPUT_ACL_MAINTENANCE - [0:0]
:INPUT_ACL_OTHER - [0:0]
:INPUT_ACL_PORT - [0:0]
:INPUT_ACL_WAN - [0:0]
:INPUT_ACL_WAN_WHITELIST - [0:0]
:INPUT_ACL_WHITELIST - [0:0]
:INPUT_ACL_WIFI - [0:0]
:INPUT_DMZIF - [0:0]
:INPUT_DOS - [0:0]
:INPUT_FIREWALL - [0:0]
:INPUT_FIREWALL_ACL - [0:0]
:INPUT_GUEST_NETWORK - [0:0]
:INPUT_PCP_WAN - [0:0]
:INPUT_PORT_SCAN - [0:0]
:INPUT_SERVICE - [0:0]
:INPUT_VOICE - [0:0]
:OUTPUT_WANSIM - [0:0]
-A INPUT -d 224.0.0.99/32 -i br+ -p udp -m udp --dport 4891 -j ACCEPT
-A INPUT -d 255.255.255.255/32 -i br+ -p udp -m udp --dport 6878 -j ACCEPT
-A INPUT -d 255.255.255.255/32 -i br+ -p udp -m udp --dport 6877 -j ACCEPT
-A INPUT -j INPUT_PORT_SCAN
-A INPUT -j INPUT_DMZIF
-A INPUT -j INPUT_VOICE
-A INPUT -j INPUT_ACL_MAINTENANCE
-A INPUT -j INPUT_ACL_WAN_WHITELIST
-A INPUT -j INPUT_ACL_WHITELIST
-A INPUT -j INPUT_ACL_PORT
-A INPUT -j INPUT_GUEST_NETWORK
-A INPUT -j INPUT_ACL_WIFI
-A INPUT -j INPUT_ACL_WAN
-A INPUT -j INPUT_ACL
-A INPUT -j INPUT_FIREWALL_ACL
-A INPUT -j INPUT_DOS
-A INPUT -j INPUT_ACL_OTHER
-A INPUT -j INPUT_SERVICE
-A INPUT -j INPUT_PCP_WAN
-A INPUT -j INPUT_FIREWALL
-A FORWARD -j FWD_PORT_SCAN
-A FORWARD -j FWD_REJECT
-A FORWARD -j FWD_GUEST_NETWORK
-A FORWARD -j FWD_ETH_INVISIBLE
-A FORWARD -j FWD_DMZIF
-A FORWARD -j FWD_WANSIM
-A FORWARD -j FWD_WANUPDOWN
-A FORWARD -j FWD_ALG
-A FORWARD -j FWD_IPFLT
-A FORWARD -j FWD_DSLITE_IPFLT
-A FORWARD -j FWD_IPFLT_DEFAULT
-A FORWARD -j FWD_FIREWALL_COMMON
-A FORWARD -j FWD_TRAFFIC_FOWARD
-A FORWARD -j FWD_SESSION_LIMIT
-A FORWARD -j FWD_IWF_PORTMAP
-A FORWARD -j FWD_PCP_PORTMAP
-A FORWARD -j FWD_UPNP_PORTMAP
-A FORWARD -j FWD_SERVICE
-A FORWARD -j FWD_HTTP_PORTMAP
-A FORWARD -j FWD_PORTMAP
-A FORWARD -j FWD_FIREWALL_RULE
-A FORWARD -j FWD_PORTTRIGGER
-A FORWARD -j FWD_IPMAPPING
-A FORWARD -j FWD_DMZ
-A FORWARD -j FWD_TUNNEL_FILTER_DEFAULT
-A FORWARD -j FWD_FIREWALL_CUST
-A FORWARD -j FWD_FIREWALL
-A OUTPUT -j OUTPUT_WANSIM
-A FWD_FIREWALL -i wan+ -j DROP
-A FWD_FIREWALL -i ppp+ -j DROP
-A FWD_FIREWALL -i br+ -m mark --mark 0x102001 -j DROP
-A FWD_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_SERVICE -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FWD_TRAFFIC_FOWARD -d 192.168.1.1/32 -j RETURN
-A FWD_WANUPDOWN -o wan+ -m mark --mark 0x102001 -j DROP
-A FWD_WANUPDOWN -o ppp+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p icmp -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -m mark --mark 0x102001 -j ACCEPT
-A INPUT_ACL -i br+ -m mark --mark 0x102001 -j DROP
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 21 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 23 -j ACCEPT
-A INPUT_ACL -i br+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 21 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 21 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 8080 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 23 -j DROP
-A INPUT_ACL -i wan+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_ACL -i ppp+ -p tcp -m tcp --dport 22 -j DROP
-A INPUT_DMZIF -p icmp -m icmp --icmp-type 13 -j DROP
-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 8 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 8 -j DROP
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 8 -m limit --limit 100/sec --limit-burst 100 -j ACCEPT
-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 8 -j DROP
	-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 5 -m limit --limit 1/sec -j ACCEPT
	-A INPUT_DOS -i wan+ -p icmp -m icmp --icmp-type 5 -j DROP
	-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 5 -m limit --limit 1/sec -j ACCEPT
	-A INPUT_DOS -i ppp+ -p icmp -m icmp --icmp-type 5 -j DROP
-A INPUT_FIREWALL -i wan+ -j DROP
-A INPUT_FIREWALL -i ppp+ -j DROP
-A INPUT_SERVICE -i wan+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i ppp+ -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT_SERVICE -i wan+ -p tcp -m tcp --dport 53 -j DROP
-A INPUT_SERVICE -i wan+ -p udp -m udp --dport 53 -j DROP
-A INPUT_SERVICE -i ppp+ -p tcp -m tcp --dport 53 -j DROP
-A INPUT_SERVICE -i ppp+ -p udp -m udp --dport 53 -j DROP
-A INPUT_SERVICE -i wan1 -p udp -m udp --dport 68 -j ACCEPT
-A INPUT_SERVICE -i br0 -p udp -m udp --dport 1900 -j ACCEPT
-A INPUT_SERVICE -i br0 -p tcp -m tcp --dport 37443 -j ACCEPT
COMMIT
# Completed on Thu Jan  1 00:33:37 1981

```